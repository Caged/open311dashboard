<html>
<head>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.10/jquery-ui.min.js"></script>
	<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.10/themes/smoothness/jquery-ui.css" type="text/css" />
	<style type="text/css">
		.widget-container { width: 400px; }
	</style>
</head>
<body>
	<div id="widget_holder"></div>
    <div id="open_req_by_type"></div>

<script type="text/javascript">
var all_widgets = [];
$(document).ready(function() {
	$.getJSON('open_requests_by_type.json', function(data) {
      
      var chart = {
          title: "Open Requests by Type",
          width: 400,
          height: 200,
          type: "bhs",
          color: "676767"
      };
      
      var params = ['http://chart.apis.google.com/chart'];

      params.push("?chxs=0,676767,11.5,0,l,FFFFFF");
      params.push("&chxt=x&chbh=a");
      params.push("&chs=" + chart.width + "x" + chart.height);
      params.push("&cht=" + chart.type);
      params.push("&chco=" + chart.color);

      var serviceCount = data.service_requests.length;
      var dataPar = [];
      var axis = [];
      var maxValue = 0;
      for (var i = 0; i < serviceCount; i++) {
          var requestType = data.service_requests[i];
          dataPar.push(requestType.open_requests);
          axis.push('t+' + requestType.service_name + ',676767,0,' + String(serviceCount - i - 1) + ',11');
          // find the largest value for the xmax caluclation
          maxValue = maxValue < requestType.open_requests ? requestType.open_requests : maxValue;
      }

      params.push("&chds=0," + maxValue);
      params.push("&chxr" + maxValue);

      params.push("&chd=t:" + dataPar.join(','));
      params.push("&chm=" + axis.join('|'));

      all_widgets.push('<h3 class="ui-widget-header">'+chart.title+'</h3><img src="' + params.join('') + '"></img>');
    });
	
	$.getJSON('open_requests_by_type2.json', function(data) {
      
      var chart = {
          title: "Open Requests by Type 2",
          width: 400,
          height: 200,
          type: "bhs",
          color: "676767"
      };
      
      var params = ['http://chart.apis.google.com/chart'];

      params.push("?chxs=0,676767,11.5,0,l,FFFFFF");
      params.push("&chxt=x&chbh=a");
      params.push("&chs=" + chart.width + "x" + chart.height);
      params.push("&cht=" + chart.type);
      params.push("&chco=" + chart.color);

      var serviceCount = data.service_requests.length;
      var dataPar = [];
      var axis = [];
      var maxValue = 0;
      for (var i = 0; i < serviceCount; i++) {
          var requestType = data.service_requests[i];
          dataPar.push(requestType.open_requests);
          axis.push('t+' + requestType.service_name + ',676767,0,' + String(serviceCount - i - 1) + ',11');
          // find the largest value for the xmax caluclation
          maxValue = maxValue < requestType.open_requests ? requestType.open_requests : maxValue;
      }

      params.push("&chds=0," + maxValue);
      params.push("&chxr" + maxValue);

      params.push("&chd=t:" + dataPar.join(','));
      params.push("&chm=" + axis.join('|'));

      all_widgets.push('<h3 class="ui-widget-header" >'+chart.title+'</h3><img src="' + params.join('') + '"></img>');
    });
	
	$( "#widget_holder" ).sortable({
		revert: true
	});
});

$(document).ajaxStop(function() {
	$.each(all_widgets, function(index, value) {
		x = $('<div id="widget-'+index+'" class="ui-widget-content widget-container">'+value+'</div>');
		x.draggable({ containment: "#widget_holder", connectToSortable: "#widget_holder",
			helper: "clone",
			revert: "invalid" });
		$('#widget_holder').append(x);
	});
});


</script>
</body>
</html>