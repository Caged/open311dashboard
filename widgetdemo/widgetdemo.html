<html>
<head>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.10/jquery-ui.min.js"></script>
	<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.10/themes/smoothness/jquery-ui.css" type="text/css" />
	<style type="text/css">
		.widget-container { 
			width: 400px;
			margin: 0px auto;
		}
		
		.column { width: 410px; float: left; padding-bottom: 10px; }
		
		#widget_holder {
			margin-left: auto;
			margin-right: auto;
		}
		
		.ui-widget-header {
			margin: 0px auto;
			font-family: Helvetica, sans-serif;
			text-align: left;
			font-size: 16px;
			color: #4c4c4c;
			padding:10px 0px 10px 10px;
		}
		
		
		.centeredImage {
			text-align:center;
			margin-top:0px;
			margin-bottom:0px;
		}

	</style>
</head>
<body>
	<div id="widget_holder">
		<div id="col0" class="column"></div>
		<div id="col1" class="column"></div>
		<div id="col2" class="column"></div>
	</div>
    <div id="open_req_by_type"></div>

<script type="text/javascript">
var all_widgets = [];
$(document).ready(function() {
	$.getJSON('open_requests_by_type.json', function(data) {
      
      var chart = {
          title: "Open Requests by Type",
          width: 380,
          height: 200,
          type: "bhs",
          color: "5db7e3"
      };
      
      var params = ['http://chart.apis.google.com/chart'];

      params.push("?chxs=0,676767,11.5,0,l,FFFFFF|1,FFFFFF,11.5,0,_,FFFFFF");
      params.push("&chxt=y,x&chbh=a");
      params.push("&chs=" + chart.width + "x" + chart.height);
      params.push("&cht=" + chart.type);
      params.push("&chco=" + chart.color);

      var serviceCount = data.service_requests.length;
      var dataPar = [];
      var axis = [];
      var dataLabels = [];
      var maxValue = 0;
	  
      for (var i = 0; i < serviceCount; i++) {
          var requestType = data.service_requests[i];
          dataPar.push((requestType.open_requests/data.total_request)*100);
          axis.push(requestType.service_name);
          dataLabels.push("t+" + requestType.open_requests + ',676767,0,' + i + ',11')
          // find the largest value for the xmax caluclation
          maxValue = maxValue < requestType.open_requests ? requestType.open_requests : maxValue;
      }

      params.push("&chds=0,100&chxr=0,0,100");

      params.push("&chd=t:" + dataPar.join(','));
      var reverseAxis = axis.reverse();
      params.push("&chxl=0:|" + reverseAxis.join('|'));
      var reverseDataLabels = dataLabels.reverse();
      params.push("&chm=" + reverseDataLabels.join('|'));

      all_widgets.push('<h3 class="ui-widget-header">'+chart.title+'</h3><p class="centeredImage"><img src="' + params.join('') + '"></img></p>');
    });
	
	$.getJSON('open_requests_by_type2.json', function(data) {
      
      var chart = {
          title: "Open Requests by Type 2",
          width: 400,
          height: 200,
          type: "bhs",
          color: "676767"
      };
      
      var params = ['http://chart.apis.google.com/chart'];

      params.push("?chxs=0,676767,11.5,0,l,FFFFFF");
      params.push("&chxt=x&chbh=a");
      params.push("&chs=" + chart.width + "x" + chart.height);
      params.push("&cht=" + chart.type);
      params.push("&chco=" + chart.color);

      var serviceCount = data.service_requests.length;
      var dataPar = [];
      var axis = [];
      var maxValue = 0;
      for (var i = 0; i < serviceCount; i++) {
          var requestType = data.service_requests[i];
          dataPar.push(requestType.open_requests);
          axis.push('t+' + requestType.service_name + ',676767,0,' + String(serviceCount - i - 1) + ',11');
          // find the largest value for the xmax caluclation
          maxValue = maxValue < requestType.open_requests ? requestType.open_requests : maxValue;
      }

      params.push("&chds=0," + maxValue);
      params.push("&chxr" + maxValue);

      params.push("&chd=t:" + dataPar.join(','));
      params.push("&chm=" + axis.join('|'));

      all_widgets.push('<h3 class="ui-widget-header">'+chart.title+'</h3><img src="' + params.join('') + '"></img>');
    });
	
});

$(document).ajaxStop(function() {
	$( ".column" ).sortable({
		connectWith: ".column"
	});
	
	$( ".column" ).disableSelection();
	
	for(var x=0; x<5;x++) {
		all_widgets.push(get_fake_widget(x));
	}
	
	var col_index = 0;
	$.each(all_widgets, function(index, value) {
		x = $('<div id="widget-'+index+'" class="ui-widget-content widget-container">'+value+'</div>');
		$('#col'+(col_index%3)).append(x);
		col_index++;
	});
});

function get_fake_widget(x) {
	color = Math.floor(Math.random()*16777215).toString(16);
	return '<h3 class="ui-widget-header">Open Requests by Type '+x+'</h3><img src="http://chart.apis.google.com/chart?chxs=0,'+color+',11.5,0,l,FFFFFF&amp;chxt=x&amp;chbh=a&amp;chs=400x200&amp;cht=bhs&amp;chco='+color+'&amp;chds=0,136&amp;chxr136&amp;chd=t:74,31,136,24,12&amp;chm=t+Sidewalk Cleaning,'+color+',0,4,11|t+Abandoned Vehicle,'+color+',0,3,11|t+Illegal Dumping,'+color+',0,2,11|t+Pavement Defect,'+color+',0,1,11|t+Street Cleaning,'+color+',0,0,11">';
}


</script>
</body>
</html>